---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=6, fig.asp = 0.618, collapse=TRUE) 
```
### In-class exercises
### Unit 3: Penguins

```{r}
library(tidyverse)
library(palmerpenguins)
library(gvlma) # gvlma()
library(car)  # vif()
```

### Exercise 1.1

Build a data set that contains only Chinstrap penguins with a flipper length > 200 mm. What is the percentage of females in that subset of data? How does that compare to the percentage of all female Chinstrap penguins included in the original data set? Use the summary() function to compare the sex ratio of the full Chinstrap dataset vs. the subset of Chinstrap penguins with a flipper length > 200 mm. Or you can use again subset the data by sex and use the dim() function to count the number of rows in the subsetted data. Given this analysis, what do you think the relationship is between sex and flipper length?

```{r}
# Sex ratio of all Chinstrap observations
summary(penguins %>% filter(species=="Chinstrap"))
sex_ratio_all = 34/68
dim(penguins %>% filter(species=="Chinstrap") %>% filter(sex=="female"))[1]/dim(penguins %>% filter(species=="Chinstrap"))[1]

# Sex ratio of Chinstrap penguins with flipper length > 200 mm
dat_exer_1 = penguins %>%
  filter(species == "Chinstrap",
         flipper_length_mm > 200)
summary(dat_exer_1)
sex_ratio_subset = 1/18
dim(dat_exer_1 %>% filter(sex=="female"))[1]/dim(dat_exer_1)[1]
```

### Exercise 1.2

Repeat Exercise 1.1, but this time use `group_by()` along with the `n()` function inside `summarize()` to count the number of Chinstrap penguins of each sex. Again compare the sex ratio of all Chinstrap observations vs. the sex ratio of Chinstrap penguins with a flipper length > 200 mm.

```{r}
penguins %>%
  filter(species == "Chinstrap") %>%
  group_by(sex) %>%
  summarize(n=n())


penguins %>%
  filter(species == "Chinstrap",
         flipper_length_mm > 200) %>%
  group_by(sex) %>%
  summarize(n=n())
```

### Exercise 1.3

What is the mean bill length (in inches) of Adelie penguins found on either Dream island or Biscoe island? What is the standard deviation? Is the mean larger or smaller than the mean bill length of Adelie penguins found on Torgersen island?

```{r}
penguins %>% 
  filter(species=="Adelie",
         island %in% c("Biscoe","Dream")) %>%
  mutate(bill_length_in = bill_length_mm * 0.039) %>% # Conversion: 0.0393701 inches / mm
  summarize(mean_bill_length_in = mean(bill_length_in), sd_bill_length_in = sd(bill_length_in))

penguins %>% 
  filter(species=="Adelie",
         island =="Torgersen",
         !is.na(bill_length_mm)) %>%
  mutate(bill_length_in = bill_length_mm * 0.039) %>% # Conversion: 0.0393701 inches / mm
  summarize(mean_bill_length_in = mean(bill_length_in), sd_bill_length_in = sd(bill_length_in))
```

### Exercise 5.1

Build a model predicting Gentoo bill length as a function of flipper length. Plot the predictions. Which explanatory variable (bill length vs. flipper length) does a better job of predicting bill depth? What is your evidence?

```{r}
gentoo = penguins %>% filter(species=="Gentoo")

lm_bill_length = lm(bill_depth_mm ~ bill_length_mm, data=gentoo)
summary(lm_bill_length)

lm_flip = lm(bill_depth_mm ~ flipper_length_mm, data=gentoo)
summary(lm_flip)

ggplot(data=gentoo, aes(x = flipper_length_mm, y = bill_depth_mm)) +
     geom_point() +
     geom_smooth(method = "lm")
```

The Adjusted $R^2$ is higher in the flipper model than in the bill length model, so flipper length does a better job of predicting bill depth for Gentoo penguins.

### Exercise 5.2

Build a linear regression to predict the bill depth of Gentoo penguins as a function of 2 explanatory continuous variables: bill length and flipper length. Do some exploratory data analysis and check model diagnostics. Use the function `vif()` to make sure that you don't have a problem with multicollinearity. Then use the function `AIC()` to compare the Akaike Information Criterion between this model and a simple linear regression we built before with bill depth as a function of just bill length. Use the help pages or the tutorial on regression diagnostics in this unit to make sure you are using `vif()` and `AIC()` correctly. What are your findings? Plot the data, the model predictions and the 95% confidence intervals or the standard errors.

####3!!!!!!!!!!!1######### Work on how we'll plot the predictions for 2 continuous variables

```{r}
# Drop NA data before fitting model. This helps me avoid problems down the line with predict()
gentoo = penguins %>%
  filter(!is.na(bill_depth_mm),
         !is.na(bill_length_mm),
         !is.na(species),
         species=="Gentoo")

# Build simple linear regression
lm_gentoo_1 = lm(bill_depth_mm ~ bill_length_mm, data=gentoo)
summary(lm_gentoo_1)

# Build multiregression
lm_gentoo_3x = lm(bill_depth_mm ~ bill_length_mm + flipper_length_mm, data=gentoo)
summary(lm_gentoo_3x) # bill length no longer significant

vif(lm_gentoo_3x) # vif values < 2, no multicollinearity
AIC(lm_gentoo_1, lm_gentoo_3x) # lm_gentoo_male_3x performs significantly better

library(ggiraph)
library(ggiraphExtra)
ggPredict(lm_gentoo_3x, se=TRUE, interactive=TRUE)
```









